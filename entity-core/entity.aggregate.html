<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>entity.aggregate documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Entity-core</span> <span class="project-version">0.1.2</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="intro.html"><div class="inner"><span>entity-core</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>entity</span></div></div></li><li class="depth-2 branch current"><a href="entity.aggregate.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>aggregate</span></div></a></li><li class="depth-2 branch"><a href="entity.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2"><a href="entity.protocol.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>protocol</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="entity.aggregate.html#var-aggregate"><div class="inner"><span>aggregate</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">entity.aggregate</h1><div class="doc"><pre class="plaintext"></pre></div><div class="public anchor" id="var-aggregate"><h3>aggregate</h3><div class="usage"><code>(aggregate data &amp; opts)</code></div><div class="doc"><pre class="plaintext">Aggregate from a (possibly empty) data structure to the
target entity reference. Provides for the common cases of
structure building.

The structure root is always a map. Non-unique keys result in
a vector whose entries are themselves maps. The key of a vector
result is always supplied by the caller as the option :set-name
By default instances are held as their unqualified type name or any
alias that was defined in the declaration.

 - data : the structure being built. Must be a map and always the
          root even in successive calls to this function.
 - opts : options as follows:
   :from &lt;path&gt;   a vector path to the thing being aggregated from.
                  This is only absent when seeding the structure
                  with its initial value (or vector of values, in the
                  case of a non-unique key). When passing through
                  a vector in the structure indicate this using '&gt;'
   :to &lt;type-ref&gt; mandatory - the type being joined in the structure.
   :key-val       when :from is present, by default it will be used
                  as the value for the target type's :primary key, however
                  this behaviour is overridden by key-val, which may
                  be either the return value of make-key or a vector tuple
                  of [key-name key-value], a keyword identifying a
                  known key or a function (see below).
   :instance-name the map key to use when placing single instances in the
                  structure. This applies whether the key being applied
                  is unique or not. The name will be used in all
                  map children housing each instance. Optional and if
                  absent the unqualified name or any alias is used.
   :set-name      the map key for the vector returned by non-unique keys
                  when placed in the parent map. Mandatory when a non-unique
                  key is being used, otherwise ignored.
   :merge         Any existing value will always be replaced by a new one.
                  In the case of a non-unique key, an existing vector
                  will be replaced unless this option specifies
                  either :primary or a function. The option of :primary
                  will merge current and new values into the result
                  vector by the primary key set. A function must accept
                  three arguments, the instance-name, current and new
                  vectors, and return a vector containing the required merge.
   :must-join     If true, when aggregating to a vector, the map child will
                  be removed for any instances that don't join with the
                  target. Otherwise the vector entry remains with a
                  nil child where there is no join.
   :for-each      A function called after the aggregation. Will be passed
                  the parent node
   :read-f        The dispatching value for the read-fn multimethod. By default
                  entity.core/read-entity will be called,
If key-val is a function it must accept three arguments. These are
 - parent : the parent node in the structure
 - from   : the value being aggregated from
 - f-opts : a map containing :key &lt;key-name&gt;, :key-val,
                             :entity &lt;the type being joined&gt;,
                             :set-name and :instance-name</pre></div><div class="src-link"><a href="https://github.com/inqwell/entity-core/blob/master/src/entity/aggregate.clj#L46">view source</a></div></div></div></body></html>